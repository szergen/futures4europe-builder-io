# Implementation Plan: Post-Page Creation Migration from Wix to Builder.io

**Branch**: `003-post-page-migration` | **Date**: 2025-12-01 | **Spec**: [spec.md](./spec.md)  
**Input**: Feature specification from `/specs/003-post-page-migration/spec.md`

**Note**: This plan is generated by the `/speckit.plan` command. See `.specify/templates/commands/plan.md` for the execution workflow.

## Summary

Migrate post-page creation and editing functionality from Wix CMS to Builder.io by:

1. Migrating the route from `/app/post/New_Post` to `/app/post-page/New_Post`
2. Replacing Wix API calls (`insertDataItem`, `updateDataItem`, `replaceDataItemReferences`) with Builder.io Write API
3. Creating utility functions in `app/utils/builderPostUtils.ts` for optimized single-call create/update operations
4. Maintaining all existing UI/UX behaviors while improving performance from 10+ API calls to 1-2 calls per save

## Technical Context

**Language/Version**: TypeScript 4.8.4 / Next.js 13.4.9 (App Router)  
**Primary Dependencies**:

- `@builder.io/sdk-react` (Builder.io SDK)
- `@builder.io/sdk` (Builder.io Core SDK)
- `next` (Next.js framework)
- `react` (React 18)

**Storage**: Builder.io cloud CMS (Write API for mutations, Read API for queries)  
**Testing**: Browser-based testing via Builder.io browser tools, E2E testing for user flows  
**Target Platform**: Next.js web application (SSR/ISR hybrid)  
**Project Type**: Web application (Next.js with client and server components)  
**Performance Goals**:

- Post creation: <3 seconds from click to redirect
- Post update: <2 seconds for save operation
- Reduce API calls from 10+ to 1-2 per save operation

**Constraints**:

- Must maintain backward compatibility with existing PostPageComponent interface
- Must preserve all existing UI/UX behaviors (edit mode, validation, etc.)
- No automatic retry on API failures (manual retry only)
- Cache invalidation must occur after save, before redirect

**Scale/Scope**:

- 3 post types (post, event, project result)
- 31 functional requirements
- ~40+ fields per post (including 10 content sections, 10 images, 10+ reference fields)
- Existing codebase with ~1074 lines in PostPageComponent

## Constitution Check

_GATE: Must pass before Phase 0 research. Re-check after Phase 1 design._

### ✅ I. Migration-First Development

- **Status**: PASS
- **Compliance**: Feature uses Builder.io as primary data source, creates Builder.io utility functions, no new Wix dependencies

### ✅ II. Content Type Parity

- **Status**: PASS
- **Compliance**: Handles all 3 post sub-types (post, event, project result) with consistent patterns

### ✅ III. Backward Compatibility

- **Status**: PASS
- **Compliance**: Maintains existing PostPageComponent interface, preserves all UI/UX behaviors per FR-022

### ✅ IV. Data Integrity & Validation

- **Status**: PASS
- **Compliance**: Validates required fields before save (FR-012), handles errors gracefully (FR-026), preserves data on failure (FR-027)

### ✅ V. Documentation & Migration Tracking

- **Status**: PASS
- **Compliance**: Feature documented in `specs/003-post-page-migration/`, follows established patterns from `specs/001-migrate-post-pages/`

### ✅ VI. Performance & Caching

- **Status**: PASS
- **Compliance**: Implements cache invalidation (FR-015, FR-030), performance goals defined (SC-001, SC-002)

### ✅ VII. Testing & Quality Assurance

- **Status**: PASS
- **Compliance**: Comprehensive acceptance scenarios defined, manual testing plan for 20+ user interactions (SC-009)

### Constitution Compliance Summary

**Result**: ✅ ALL GATES PASS - Proceed to Phase 0

No violations requiring justification. All 7 core principles are satisfied.

## Project Structure

### Documentation (this feature)

```text
specs/003-post-page-migration/
├── spec.md              # Feature specification (✅ Complete)
├── checklists/
│   └── requirements.md  # Spec quality checklist (✅ Complete)
├── plan.md              # This file (/speckit.plan command output)
├── research.md          # Phase 0 output (created below)
├── data-model.md        # Phase 1 output (created below)
├── quickstart.md        # Phase 1 output (created below)
├── contracts/           # Phase 1 output (created below)
│   └── builderPostAPI.md
└── tasks.md             # Phase 2 output (/speckit.tasks command - NOT created by /speckit.plan)
```

### Source Code (repository root)

```text
app/
├── post-page/
│   └── New_Post/
│       └── page.tsx                    # New route (migrated from app/post/New_Post)
├── page-components/
│   └── PostPageComponent/
│       ├── PostPageComponent.tsx       # Main component (MODIFIED - update create/save functions)
│       ├── PostPageComponent.module.css
│       └── components/                 # Sub-components (unchanged)
├── utils/
│   ├── builderPostUtils.ts            # MODIFIED - add create/update API functions
│   ├── cache-utils.ts                 # EXISTING - cache invalidation utilities
│   └── PageComponents.utils.ts        # EXISTING - sanitizeTitleForSlug, generateUniqueHash
└── shared-components/
    └── Builder/
        └── builderUtils.ts             # EXISTING - getBuilderContent (read-only)

scripts/
└── migrations/
    └── migrate-posts.js                # REFERENCE - existing Builder.io API patterns

tests/ (future)
└── e2e/
    └── post-creation.spec.ts           # E2E tests for create/edit flows
```

**Structure Decision**: This is a web application using Next.js App Router. The migration focuses on:

- **Route migration**: `app/post/New_Post` → `app/post-page/New_Post`
- **Component updates**: `PostPageComponent.tsx` functions `createNewPost()` and `updateDataToServer()`
- **Utility creation**: New functions in `builderPostUtils.ts` for Builder.io Write API
- **No new components**: Reuses existing PostPageComponent with modified save logic

## Complexity Tracking

> No constitutional violations - this section intentionally left empty.

---

## Phase 0: Research & Decisions

**Status**: ✅ COMPLETE (see research.md below)

### Research Tasks Completed

1. ✅ Builder.io Write API patterns (from existing migration scripts)
2. ✅ Reference field transformation approach (from builderPostUtils.ts)
3. ✅ Error handling strategy (from migration scripts)
4. ✅ Cache invalidation integration (from cache-utils.ts)

All technical unknowns resolved - proceeding to Phase 1.

---

## Phase 1: Data Model & Contracts

**Status**: ✅ COMPLETE (see data-model.md and contracts/ below)

### Deliverables

1. ✅ Data model documentation (data-model.md)
2. ✅ API contracts (contracts/builderPostAPI.md)
3. ✅ Quickstart guide (quickstart.md)
4. ⏳ Agent context update (pending)

---

## Phase 2: Tasks & Implementation

**Status**: ⏳ PENDING - Run `/speckit.tasks` to generate task breakdown

This phase will create `tasks.md` with:

- Detailed task breakdown for all 31 functional requirements
- Implementation order and dependencies
- Testing checklist for all 3 post types
- Validation steps for 10 success criteria

---

## Notes

- This migration builds on patterns established in `001-migrate-post-pages` (data migration) and `002-infopages-migration` (info pages)
- The key optimization is batching all reference field updates into a single API call instead of Wix's 10+ separate calls
- Existing UI components remain unchanged - only backend save logic is modified
- Cache invalidation timing is critical: must occur after save but before redirect per clarification Q3
